<div class="shadow"><ol>
    <li><span class="kwd">package</span> <span class="pln">main</span></li>
    <li></li>
    <li><span class="kwd">import</span> <span class="pun">(</span></li>
    <li>	<span class="str">"machine"</span></li>
    <li>	<span class="str">"time"</span></li>
    <li></li>
    <li>	<span class="str">"image/color"</span></li>
    <li></li>
    <li>	<span class="str">"math/rand"</span></li>
    <li></li>
    <li>	<span class="str">"tinygo.org/x/tinyfont"</span> <span class="com">// Package for showing text on display</span></li>
    <li>	<span class="str">"tinygo.org/x/drivers/ds3231"</span> <span class="com">// Driver for Real-Time Clock DS3231</span></li>
    <li>	<span class="str">"tinygo.org/x/drivers/hub75"</span> <span class="com">// Driver for HUB75 RGB LED matrix</span></li>
    <li><span class="pun">)</span></li>
    <li></li>
    <li><span class="kwd">const</span> <span class="pun">(</span></li>
    <li>	<span class="typ">IDLE</span>   <span class="typ">Status</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>	<span class="typ">PLAY</span>   <span class="typ">Status</span> <span class="pun">=</span> <span class="dec">1</span></li>
    <li>	<span class="typ">WINNER</span> <span class="typ">Status</span> <span class="pun">=</span> <span class="dec">2</span></li>
    <li><span class="pun">)</span></li>
    <li></li>
    <li><span class="kwd">type</span> <span class="typ">Status</span> <span class="pln">uint8</span></li>
    <li></li>
    <li><span class="kwd">type</span> <span class="typ">Game</span> <span class="kwd">struct</span> <span class="pun">{</span></li>
    <li>	<span class="pln">display</span> <span class="pln">hub75</span><span class="pun">.</span><span class="typ">Device</span></li>
    <li>	<span class="pln">colors</span>  <span class="pun">[]</span><span class="pln">color</span><span class="pun">.</span><span class="typ">RGBA</span></li>
    <li>	<span class="pln">rtc</span>     <span class="pln">ds3231</span><span class="pun">.</span><span class="typ">Device</span></li>
    <li>	<span class="pln">dt</span>      <span class="pln">time</span><span class="pun">.</span><span class="typ">Time</span></li>
    <li>	<span class="pln">timeStr</span> <span class="pun">[]</span><span class="kwd">byte</span></li>
    <li>	<span class="pln">players</span> <span class="pun">[</span><span class="dec">2</span><span class="pun">]</span><span class="typ">Player</span></li>
    <li>	<span class="pln">ball</span>    <span class="typ">Ball</span></li>
    <li>	<span class="pln">status</span>  <span class="typ">Status</span></li>
    <li><span class="pun">}</span></li>
    <li></li>
    <li><span class="kwd">type</span> <span class="typ">Player</span> <span class="kwd">struct</span> <span class="pun">{</span></li>
    <li>	<span class="pln">pin</span>     <span class="pln">machine</span><span class="pun">.</span><span class="typ">ADC</span></li>
    <li>	<span class="pln">y</span>       <span class="kwd">int16</span></li>
    <li>	<span class="pln">lastY</span>   <span class="kwd">int16</span></li>
    <li>	<span class="pln">targetY</span> <span class="kwd">float32</span></li>
    <li>	<span class="pln">score</span>   <span class="pln">uint8</span></li>
    <li><span class="pun">}</span></li>
    <li></li>
    <li><span class="kwd">type</span> <span class="typ">Ball</span> <span class="kwd">struct</span> <span class="pun">{</span></li>
    <li>	<span class="pln">x</span><span class="pun">,</span> <span class="pln">y</span><span class="pun">,</span> <span class="pln">vx</span><span class="pun">,</span> <span class="pln">vy</span> <span class="kwd">float32</span></li>
    <li><span class="pun">}</span></li>
    <li></li>
    <li><span class="kwd">func</span> <span class="pln">main</span><span class="pun">()</span> <span class="pun">{</span></li>
    <li>	<span class="kwd">var</span> <span class="pln">game</span> <span class="typ">Game</span></li>
    <li>	<span class="kwd">var</span> <span class="pln">err</span> <span class="pln">error</span></li>
    <li>	<span class="com">// SPI for the hub75</span></li>
    <li>	<span class="pln">machine</span><span class="pun">.</span><span class="typ">SPI0</span><span class="pun">.</span><span class="typ">Configure</span><span class="pun">(</span><span class="pln">machine</span><span class="pun">.</span><span class="typ">SPIConfig</span><span class="pun">{</span></li>
    <li>		<span class="typ">Frequency</span><span class="pun">:</span> <span class="dec">8000000</span><span class="pun">,</span></li>
    <li>		<span class="typ">Mode</span><span class="pun">:</span>      <span class="dec">0</span><span class="pun">})</span></li>
    <li>	<span class="com">// I2C for the RTC DS3231</span></li>
    <li>	<span class="pln">machine</span><span class="pun">.</span><span class="typ">I2C0</span><span class="pun">.</span><span class="typ">Configure</span><span class="pun">(</span><span class="pln">machine</span><span class="pun">.</span><span class="typ">I2CConfig</span><span class="pun">{})</span></li>
    <li></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">display</span> <span class="pun">=</span> <span class="pln">hub75</span><span class="pun">.</span><span class="typ">New</span><span class="pun">(</span><span class="pln">machine</span><span class="pun">.</span><span class="typ">SPI0</span><span class="pun">,</span> <span class="pln">machine</span><span class="pun">.</span><span class="typ">D6</span><span class="pun">,</span> <span class="pln">machine</span><span class="pun">.</span><span class="typ">D5</span><span class="pun">,</span> <span class="pln">machine</span><span class="pun">.</span><span class="typ">D8</span><span class="pun">,</span> <span class="pln">machine</span><span class="pun">.</span><span class="typ">D10</span><span class="pun">,</span> <span class="pln">machine</span><span class="pun">.</span><span class="typ">D9</span><span class="pun">,</span> <span class="pln">machine</span><span class="pun">.</span><span class="typ">D7</span><span class="pun">)</span></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">Configure</span><span class="pun">(</span><span class="pln">hub75</span><span class="pun">.</span><span class="typ">Config</span><span class="pun">{</span></li>
    <li>		<span class="typ">Width</span><span class="pun">:</span>      <span class="dec">64</span><span class="pun">,</span></li>
    <li>		<span class="typ">Height</span><span class="pun">:</span>     <span class="dec">32</span><span class="pun">,</span></li>
    <li>		<span class="typ">RowPattern</span><span class="pun">:</span> <span class="dec">16</span><span class="pun">,</span></li>
    <li>		<span class="typ">ColorDepth</span><span class="pun">:</span> <span class="dec">2</span><span class="pun">,</span></li>
    <li>		<span class="typ">FastUpdate</span><span class="pun">:</span> <span class="kwd">true</span><span class="pun">,</span></li>
    <li>	<span class="pun">})</span></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">SetBrightness</span><span class="pun">(</span><span class="dec">100</span><span class="pun">)</span></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">ClearDisplay</span><span class="pun">()</span></li>
    <li></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">rtc</span> <span class="pun">=</span> <span class="pln">ds3231</span><span class="pun">.</span><span class="typ">New</span><span class="pun">(</span><span class="pln">machine</span><span class="pun">.</span><span class="typ">I2C0</span><span class="pun">)</span></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">rtc</span><span class="pun">.</span><span class="typ">Configure</span><span class="pun">()</span></li>
    <li></li>
    <li>	<span class="pln">machine</span><span class="pun">.</span><span class="typ">InitADC</span><span class="pun">()</span></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">pin</span> <span class="pun">=</span> <span class="pln">machine</span><span class="pun">.</span><span class="typ">ADC</span><span class="pun">{</span><span class="pln">machine</span><span class="pun">.</span><span class="typ">A1</span><span class="pun">}</span></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">pin</span><span class="pun">.</span><span class="typ">Configure</span><span class="pun">()</span></li>
    <li></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">pin</span> <span class="pun">=</span> <span class="pln">machine</span><span class="pun">.</span><span class="typ">ADC</span><span class="pun">{</span><span class="pln">machine</span><span class="pun">.</span><span class="typ">A2</span><span class="pun">}</span></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">pin</span><span class="pun">.</span><span class="typ">Configure</span><span class="pun">()</span></li>
    <li></li>
    <li>	<span class="com">// Check if the RTC is working properly</span></li>
    <li>	<span class="pln">valid</span> <span class="pun">:=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">rtc</span><span class="pun">.</span><span class="typ">IsTimeValid</span><span class="pun">()</span></li>
    <li>	<span class="kwd">if</span> <span class="pun">!</span><span class="pln">valid</span> <span class="pun">{</span></li>
    <li>		<span class="pln">date</span> <span class="pun">:=</span> <span class="pln">time</span><span class="pun">.</span><span class="typ">Date</span><span class="pun">(</span><span class="dec">2019</span><span class="pun">,</span> <span class="dec">12</span><span class="pun">,</span> <span class="dec">13</span><span class="pun">,</span> <span class="dec">20</span><span class="pun">,</span> <span class="dec">16</span><span class="pun">,</span> <span class="dec">22</span><span class="pun">,</span> <span class="dec">0</span><span class="pun">,</span> <span class="pln">time</span><span class="pun">.</span><span class="typ">UTC</span><span class="pun">)</span></li>
    <li>		<span class="pln">game</span><span class="pun">.</span><span class="pln">rtc</span><span class="pun">.</span><span class="typ">SetTime</span><span class="pun">(</span><span class="pln">date</span><span class="pun">)</span></li>
    <li>	<span class="pun">}</span></li>
    <li></li>
    <li>	<span class="pln">running</span> <span class="pun">:=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">rtc</span><span class="pun">.</span><span class="typ">IsRunning</span><span class="pun">()</span></li>
    <li>	<span class="kwd">if</span> <span class="pun">!</span><span class="pln">running</span> <span class="pun">{</span></li>
    <li>		<span class="pln">err</span> <span class="pun">:=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">rtc</span><span class="pun">.</span><span class="typ">SetRunning</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span></li>
    <li>		<span class="kwd">if</span> <span class="pln">err</span> <span class="pun">!=</span> <span class="kwd">nil</span> <span class="pun">{</span></li>
    <li>			<span class="pln">println</span><span class="pun">(</span><span class="str">"Error configuring RTC"</span><span class="pun">)</span></li>
    <li>		<span class="pun">}</span></li>
    <li>	<span class="pun">}</span></li>
    <li></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">colors</span> <span class="pun">=</span> <span class="pun">[]</span><span class="pln">color</span><span class="pun">.</span><span class="typ">RGBA</span><span class="pun">{</span></li>
    <li>		<span class="pun">{</span><span class="dec">255</span><span class="pun">,</span> <span class="dec">0</span><span class="pun">,</span> <span class="dec">0</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">},</span></li>
    <li>		<span class="pun">{</span><span class="dec">255</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">,</span> <span class="dec">0</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">},</span></li>
    <li>		<span class="pun">{</span><span class="dec">0</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">,</span> <span class="dec">0</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">},</span></li>
    <li>		<span class="pun">{</span><span class="dec">0</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">},</span></li>
    <li>		<span class="pun">{</span><span class="dec">0</span><span class="pun">,</span> <span class="dec">0</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">},</span></li>
    <li>		<span class="pun">{</span><span class="dec">255</span><span class="pun">,</span> <span class="dec">0</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">},</span></li>
    <li>		<span class="pun">{</span><span class="dec">255</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">},</span></li>
    <li>		<span class="pun">{</span><span class="dec">0</span><span class="pun">,</span> <span class="dec">0</span><span class="pun">,</span> <span class="dec">0</span><span class="pun">,</span> <span class="dec">255</span><span class="pun">},</span></li>
    <li>	<span class="pun">}</span></li>
    <li></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">timeStr</span> <span class="pun">=</span> <span class="kwd">make</span><span class="pun">([]</span><span class="kwd">byte</span><span class="pun">,</span> <span class="dec">2</span><span class="pun">)</span></li>
    <li>	<span class="kwd">then</span> <span class="pun">:=</span> <span class="pln">time</span><span class="pun">.</span><span class="typ">Now</span><span class="pun">()</span></li>
    <li>	<span class="pln">game</span><span class="pun">.</span><span class="pln">status</span> <span class="pun">=</span> <span class="typ">IDLE</span></li>
    <li></li>
    <li>	<span class="kwd">for</span> <span class="pun">{</span></li>
    <li>		<span class="kwd">switch</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">status</span> <span class="pun">{</span></li>
    <li>		<span class="kwd">case</span> <span class="typ">PLAY</span><span class="pun">:</span></li>
    <li>			<span class="pln">gameStopped</span> <span class="pun">:=</span> <span class="pln">uint8</span><span class="pun">(</span><span class="dec">0</span><span class="pun">)</span></li>
    <li>			<span class="pln">k</span> <span class="pun">:=</span> <span class="pln">uint8</span><span class="pun">(</span><span class="dec">0</span><span class="pun">)</span></li>
    <li></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">newRound</span><span class="pun">(</span><span class="dec">0</span><span class="pun">)</span></li>
    <li>			<span class="pln">gameStopped</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li></li>
    <li>			<span class="kwd">for</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">status</span> <span class="pun">==</span> <span class="typ">PLAY</span> <span class="pun">{</span></li>
    <li>				<span class="kwd">if</span> <span class="pln">time</span><span class="pun">.</span><span class="typ">Since</span><span class="pun">(</span><span class="kwd">then</span><span class="pun">).</span><span class="typ">Nanoseconds</span><span class="pun">()</span> <span class="pun">&gt;</span> <span class="dec">8000000</span> <span class="pun">{</span></li>
    <li>					<span class="kwd">then</span> <span class="pun">=</span> <span class="pln">time</span><span class="pun">.</span><span class="typ">Now</span><span class="pun">()</span></li>
    <li>					<span class="pln">game</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">ClearDisplay</span><span class="pun">()</span></li>
    <li></li>
    <li>					<span class="kwd">if</span> <span class="pln">gameStopped</span> <span class="pun">&lt;</span> <span class="dec">20</span> <span class="pun">{</span></li>
    <li>						<span class="pln">gameStopped</span><span class="pun">++</span></li>
    <li>					<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>						<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">+=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span></li>
    <li>						<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">+=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span></li>
    <li></li>
    <li>						<span class="kwd">for</span> <span class="pln">k</span> <span class="pun">=</span> <span class="dec">0</span><span class="pun">;</span> <span class="pln">k</span> <span class="pun">&lt;</span> <span class="dec">2</span><span class="pun">;</span> <span class="pln">k</span><span class="pun">++</span> <span class="pun">{</span></li>
    <li>							<span class="kwd">if</span> <span class="pun">(</span><span class="pln">k</span> <span class="pun">==</span> <span class="dec">1</span> <span class="pun">&amp;&amp;</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">&gt;=</span> <span class="dec">60</span><span class="pun">)</span> <span class="pun">||</span> <span class="pun">(</span><span class="pln">k</span> <span class="pun">==</span> <span class="dec">0</span> <span class="pun">&amp;&amp;</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">&lt;=</span> <span class="dec">2</span><span class="pun">)</span> <span class="pun">{</span></li>
    <li>								<span class="kwd">if</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span><span class="pun">)</span> <span class="pun">&lt;</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="pln">k</span><span class="pun">].</span><span class="pln">y</span><span class="pun">-</span><span class="dec">1</span> <span class="pun">||</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span><span class="pun">)</span> <span class="pun">&gt;</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="pln">k</span><span class="pun">].</span><span class="pln">y</span><span class="pun">+</span><span class="dec">7</span> <span class="pun">{</span></li>
    <li>									<span class="pln">game</span><span class="pun">.</span><span class="pln">newRound</span><span class="pun">((</span><span class="pln">k</span> <span class="pun">+</span> <span class="dec">1</span><span class="pun">)</span> <span class="pun">%</span> <span class="dec">2</span><span class="pun">)</span></li>
    <li>									<span class="pln">gameStopped</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>								<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>									<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span> <span class="pun">=</span> <span class="pun">-</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span></li>
    <li>									<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">+=</span> <span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">-</span> <span class="kwd">float32</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="pln">k</span><span class="pun">].</span><span class="pln">y</span><span class="pun">)</span> <span class="pun">-</span> <span class="dec">3</span><span class="pun">)</span> <span class="pun">*</span> <span class="dec">0.2</span></li>
    <li>									<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">&gt;</span> <span class="dec">2.5</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">=</span> <span class="dec">2.5</span></li>
    <li>									<span class="pun">}</span></li>
    <li>									<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">&lt;</span> <span class="pun">-</span><span class="dec">2.5</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">=</span> <span class="pun">-</span><span class="dec">2.5</span></li>
    <li>									<span class="pun">}</span></li>
    <li>								<span class="pun">}</span></li>
    <li>							<span class="pun">}</span></li>
    <li>						<span class="pun">}</span></li>
    <li></li>
    <li>						<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">&gt;=</span> <span class="dec">30</span> <span class="pun">||</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">&lt;=</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">=</span> <span class="pun">-</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span></li>
    <li>						<span class="pun">}</span></li>
    <li></li>
    <li>						<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">&lt;</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>						<span class="pun">}</span></li>
    <li>						<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">&gt;</span> <span class="dec">30</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">=</span> <span class="dec">30</span></li>
    <li>						<span class="pun">}</span></li>
    <li>					<span class="pun">}</span></li>
    <li></li>
    <li>					<span class="kwd">for</span> <span class="pln">k</span> <span class="pun">=</span> <span class="dec">0</span><span class="pun">;</span> <span class="pln">k</span> <span class="pun">&lt;</span> <span class="dec">2</span><span class="pun">;</span> <span class="pln">k</span><span class="pun">++</span> <span class="pun">{</span></li>
    <li>						<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="pln">k</span><span class="pun">].</span><span class="pln">y</span> <span class="pun">=</span> <span class="kwd">int16</span><span class="pun">((</span><span class="dec">65535</span><span class="pun">-</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="pln">k</span><span class="pun">].</span><span class="pln">pin</span><span class="pun">.</span><span class="typ">Get</span><span class="pun">())/</span><span class="dec">2048</span><span class="pun">)</span> <span class="pun">-</span> <span class="dec">4</span></li>
    <li>						<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="pln">k</span><span class="pun">].</span><span class="pln">y</span> <span class="pun">&lt;</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="pln">k</span><span class="pun">].</span><span class="pln">y</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>						<span class="pun">}</span></li>
    <li>						<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="pln">k</span><span class="pun">].</span><span class="pln">y</span> <span class="pun">&gt;</span> <span class="dec">24</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="pln">k</span><span class="pun">].</span><span class="pln">y</span> <span class="pun">=</span> <span class="dec">24</span></li>
    <li>						<span class="pun">}</span></li>
    <li>					<span class="pun">}</span></li>
    <li></li>
    <li>					<span class="com">// show stuff on the display</span></li>
    <li>					<span class="pln">game</span><span class="pun">.</span><span class="pln">drawNet</span><span class="pun">()</span></li>
    <li>					<span class="pln">game</span><span class="pun">.</span><span class="pln">drawPlayers</span><span class="pun">()</span></li>
    <li>					<span class="pln">game</span><span class="pun">.</span><span class="pln">drawBall</span><span class="pun">()</span></li>
    <li>					<span class="pln">game</span><span class="pun">.</span><span class="pln">updateScore</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">score</span><span class="pun">,</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">score</span><span class="pun">,</span> <span class="kwd">false</span><span class="pun">)</span></li>
    <li>				<span class="pun">}</span></li>
    <li>				<span class="pln">game</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">Display</span><span class="pun">()</span></li>
    <li>			<span class="pun">}</span></li>
    <li>			<span class="kwd">break</span></li>
    <li>		<span class="kwd">case</span> <span class="typ">WINNER</span><span class="pun">:</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">ClearDisplay</span><span class="pun">()</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">status</span> <span class="pun">=</span> <span class="typ">IDLE</span></li>
    <li>			<span class="kwd">then</span> <span class="pun">=</span> <span class="pln">time</span><span class="pun">.</span><span class="typ">Now</span><span class="pun">()</span></li>
    <li>			<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">score</span><span class="pun">&gt;=</span><span class="dec">50</span> <span class="pun">{</span></li>
    <li>				<span class="pln">tinyfont</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(&amp;</span><span class="pln">game</span><span class="pun">.</span><span class="pln">display</span><span class="pun">,</span> <span class="pun">&amp;</span><span class="pln">tinyfont</span><span class="pun">.</span><span class="typ">TomThumb</span><span class="pun">,</span> <span class="dec">10</span><span class="pun">,</span> <span class="dec">12</span><span class="pun">,</span> <span class="pun">[]</span><span class="kwd">byte</span><span class="pun">(</span><span class="str">"PLAYER 1"</span><span class="pun">),</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">colors</span><span class="pun">[</span><span class="dec">2</span><span class="pun">])</span></li>
    <li>			<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>				<span class="pln">tinyfont</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(&amp;</span><span class="pln">game</span><span class="pun">.</span><span class="pln">display</span><span class="pun">,</span> <span class="pun">&amp;</span><span class="pln">tinyfont</span><span class="pun">.</span><span class="typ">TomThumb</span><span class="pun">,</span> <span class="dec">10</span><span class="pun">,</span> <span class="dec">12</span><span class="pun">,</span> <span class="pun">[]</span><span class="kwd">byte</span><span class="pun">(</span><span class="str">"PLAYER 2"</span><span class="pun">),</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">colors</span><span class="pun">[</span><span class="dec">2</span><span class="pun">])</span></li>
    <li>			<span class="pun">}</span></li>
    <li>			<span class="pln">tinyfont</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(&amp;</span><span class="pln">game</span><span class="pun">.</span><span class="pln">display</span><span class="pun">,</span> <span class="pun">&amp;</span><span class="pln">tinyfont</span><span class="pun">.</span><span class="typ">TomThumb</span><span class="pun">,</span> <span class="dec">30</span><span class="pun">,</span> <span class="dec">24</span><span class="pun">,</span> <span class="pun">[]</span><span class="kwd">byte</span><span class="pun">(</span><span class="str">"WINS"</span><span class="pun">),</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">colors</span><span class="pun">[</span><span class="dec">3</span><span class="pun">])</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">score</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">score</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">lastY</span> <span class="pun">=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">pin</span><span class="pun">.</span><span class="typ">Get</span><span class="pun">()</span> <span class="pun">/</span> <span class="dec">16384</span><span class="pun">)</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">lastY</span> <span class="pun">=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">pin</span><span class="pun">.</span><span class="typ">Get</span><span class="pun">()</span> <span class="pun">/</span> <span class="dec">16384</span><span class="pun">)</span></li>
    <li>			<span class="kwd">for</span> <span class="pun">{</span></li>
    <li>				<span class="kwd">if</span> <span class="pln">time</span><span class="pun">.</span><span class="typ">Since</span><span class="pun">(</span><span class="kwd">then</span><span class="pun">).</span><span class="typ">Seconds</span><span class="pun">()</span> <span class="pun">&gt;</span> <span class="dec">5</span> <span class="pun">{</span></li>
    <li>					<span class="kwd">break</span></li>
    <li>				<span class="pun">}</span></li>
    <li>				<span class="pln">game</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">Display</span><span class="pun">()</span></li>
    <li>			<span class="pun">}</span></li>
    <li></li>
    <li>			<span class="kwd">break</span></li>
    <li>		<span class="kwd">case</span> <span class="typ">IDLE</span><span class="pun">:</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">dt</span><span class="pun">,</span> <span class="pln">err</span> <span class="pun">=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">rtc</span><span class="pun">.</span><span class="typ">ReadTime</span><span class="pun">()</span></li>
    <li>			<span class="pln">hour</span> <span class="pun">:=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">dt</span><span class="pun">.</span><span class="typ">Hour</span><span class="pun">()</span></li>
    <li>			<span class="pln">minute</span> <span class="pun">:=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">dt</span><span class="pun">.</span><span class="typ">Minute</span><span class="pun">()</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">updateScore</span><span class="pun">(</span><span class="pln">uint8</span><span class="pun">(</span><span class="pln">hour</span><span class="pun">),</span> <span class="pln">uint8</span><span class="pun">(</span><span class="pln">minute</span><span class="pun">),</span> <span class="kwd">true</span><span class="pun">)</span></li>
    <li></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">=</span> <span class="kwd">float32</span><span class="pun">(</span><span class="dec">31</span><span class="pun">)</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">=</span> <span class="pln">rand</span><span class="pun">.</span><span class="typ">Float32</span><span class="pun">()*</span><span class="dec">16</span> <span class="pun">+</span> <span class="dec">8</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">y</span> <span class="pun">=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="dec">8</span><span class="pun">)</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">y</span> <span class="pun">=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="dec">18</span><span class="pun">)</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span> <span class="pun">=</span> <span class="kwd">float32</span><span class="pun">(</span><span class="dec">1</span><span class="pun">)</span></li>
    <li>			<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">=</span> <span class="kwd">float32</span><span class="pun">(</span><span class="dec">0.5</span><span class="pun">)</span></li>
    <li>			<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">dt</span><span class="pun">.</span><span class="typ">Second</span><span class="pun">()</span> <span class="pun">&gt;</span> <span class="dec">29</span> <span class="pun">{</span></li>
    <li>				<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">=</span> <span class="pun">-</span><span class="dec">0.5</span></li>
    <li>			<span class="pun">}</span></li>
    <li></li>
    <li>			<span class="pln">playerLoss</span> <span class="pun">:=</span> <span class="kwd">int8</span><span class="pun">(</span><span class="dec">0</span><span class="pun">)</span></li>
    <li>			<span class="pln">gameStopped</span> <span class="pun">:=</span> <span class="pln">uint8</span><span class="pun">(</span><span class="dec">0</span><span class="pun">)</span></li>
    <li></li>
    <li>			<span class="kwd">for</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">status</span> <span class="pun">==</span> <span class="typ">IDLE</span> <span class="pun">{</span></li>
    <li>				<span class="kwd">if</span> <span class="pln">time</span><span class="pun">.</span><span class="typ">Since</span><span class="pun">(</span><span class="kwd">then</span><span class="pun">).</span><span class="typ">Nanoseconds</span><span class="pun">()</span> <span class="pun">&gt;</span> <span class="dec">8000000</span> <span class="pun">{</span></li>
    <li>					<span class="kwd">then</span> <span class="pun">=</span> <span class="pln">time</span><span class="pun">.</span><span class="typ">Now</span><span class="pun">()</span></li>
    <li>					<span class="pln">game</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">ClearDisplay</span><span class="pun">()</span></li>
    <li></li>
    <li>					<span class="kwd">if</span> <span class="pln">gameStopped</span> <span class="pun">&lt;</span> <span class="dec">20</span> <span class="pun">{</span></li>
    <li>						<span class="pln">gameStopped</span><span class="pun">++</span></li>
    <li>					<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li></li>
    <li>						<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">+=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span></li>
    <li>						<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">+=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span></li>
    <li></li>
    <li>						<span class="kwd">if</span> <span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">&gt;=</span> <span class="dec">60</span> <span class="pun">&amp;&amp;</span> <span class="pln">playerLoss</span> <span class="pun">!=</span> <span class="dec">1</span><span class="pun">)</span> <span class="pun">||</span> <span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">&lt;=</span> <span class="dec">2</span> <span class="pun">&amp;&amp;</span> <span class="pln">playerLoss</span> <span class="pun">!=</span> <span class="pun">-</span><span class="dec">1</span><span class="pun">)</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span> <span class="pun">=</span> <span class="pun">-</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span></li>
    <li>							<span class="pln">tmp</span> <span class="pun">:=</span> <span class="pln">rand</span><span class="pun">.</span><span class="typ">Int31n</span><span class="pun">(</span><span class="dec">4</span><span class="pun">)</span> <span class="com">// perform a random, last second flick to inflict effect on the ball</span></li>
    <li>							<span class="kwd">if</span> <span class="pln">tmp</span> <span class="pun">&gt;</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>								<span class="pln">tmp</span> <span class="pun">=</span> <span class="pln">rand</span><span class="pun">.</span><span class="typ">Int31n</span><span class="pun">(</span><span class="dec">2</span><span class="pun">)</span></li>
    <li>								<span class="kwd">if</span> <span class="pln">tmp</span> <span class="pun">==</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>									<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">&gt;</span> <span class="dec">0</span> <span class="pun">&amp;&amp;</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">&lt;</span> <span class="dec">2.5</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">+=</span> <span class="dec">0.2</span></li>
    <li>									<span class="pun">}</span> <span class="kwd">else</span> <span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">&lt;</span> <span class="dec">0</span> <span class="pun">&amp;&amp;</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">&gt;</span> <span class="pun">-</span><span class="dec">2.5</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">-=</span> <span class="dec">0.2</span></li>
    <li>									<span class="pun">}</span></li>
    <li>									<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">&gt;=</span> <span class="dec">60</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">+=</span> <span class="dec">1</span> <span class="pun">+</span> <span class="dec">3</span><span class="pun">*</span><span class="pln">rand</span><span class="pun">.</span><span class="typ">Float32</span><span class="pun">()</span></li>
    <li>									<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">+=</span> <span class="dec">1</span> <span class="pun">+</span> <span class="dec">3</span><span class="pun">*</span><span class="pln">rand</span><span class="pun">.</span><span class="typ">Float32</span><span class="pun">()</span></li>
    <li>									<span class="pun">}</span></li>
    <li>								<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>									<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">&gt;</span> <span class="dec">0.5</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">-=</span> <span class="dec">0.2</span></li>
    <li>									<span class="pun">}</span> <span class="kwd">else</span> <span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">&lt;</span> <span class="pun">-</span><span class="dec">0.5</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">+=</span> <span class="dec">0.2</span></li>
    <li>									<span class="pun">}</span></li>
    <li>									<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">&gt;=</span> <span class="dec">60</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">-=</span> <span class="dec">1</span> <span class="pun">+</span> <span class="dec">3</span><span class="pun">*</span><span class="pln">rand</span><span class="pun">.</span><span class="typ">Float32</span><span class="pun">()</span></li>
    <li>									<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">-=</span> <span class="dec">1</span> <span class="pun">+</span> <span class="dec">3</span><span class="pun">*</span><span class="pln">rand</span><span class="pun">.</span><span class="typ">Float32</span><span class="pun">()</span></li>
    <li>									<span class="pun">}</span></li>
    <li>								<span class="pun">}</span></li>
    <li>								<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&lt;</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>									<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>								<span class="pun">}</span></li>
    <li>								<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&gt;</span> <span class="dec">24</span> <span class="pun">{</span></li>
    <li>									<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">24</span></li>
    <li>								<span class="pun">}</span></li>
    <li>								<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&lt;</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>									<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>								<span class="pun">}</span></li>
    <li>								<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&gt;</span> <span class="dec">24</span> <span class="pun">{</span></li>
    <li>									<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">24</span></li>
    <li>								<span class="pun">}</span></li>
    <li>							<span class="pun">}</span></li>
    <li>						<span class="pun">}</span> <span class="kwd">else</span> <span class="kwd">if</span> <span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">&gt;</span> <span class="dec">62</span> <span class="pun">&amp;&amp;</span> <span class="pln">playerLoss</span> <span class="pun">==</span> <span class="dec">1</span><span class="pun">)</span> <span class="pun">||</span> <span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">&lt;</span> <span class="dec">0</span> <span class="pun">&amp;&amp;</span> <span class="pln">playerLoss</span> <span class="pun">==</span> <span class="pun">-</span><span class="dec">1</span><span class="pun">)</span> <span class="pun">{</span></li>
    <li>							<span class="com">// RESET GAME</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">=</span> <span class="kwd">float32</span><span class="pun">(</span><span class="dec">31</span><span class="pun">)</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">=</span> <span class="pln">rand</span><span class="pun">.</span><span class="typ">Float32</span><span class="pun">()*</span><span class="dec">16</span> <span class="pun">+</span> <span class="dec">8</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span> <span class="pun">=</span> <span class="kwd">float32</span><span class="pun">(</span><span class="dec">1</span><span class="pun">)</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">=</span> <span class="kwd">float32</span><span class="pun">(</span><span class="dec">0.5</span><span class="pun">)</span></li>
    <li>							<span class="kwd">if</span> <span class="pln">rand</span><span class="pun">.</span><span class="typ">Int31n</span><span class="pun">(</span><span class="dec">2</span><span class="pun">)</span> <span class="pun">==</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>								<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">=</span> <span class="pun">-</span><span class="dec">0.5</span></li>
    <li>							<span class="pun">}</span></li>
    <li>							<span class="pln">hour</span> <span class="pun">=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">dt</span><span class="pun">.</span><span class="typ">Hour</span><span class="pun">()</span></li>
    <li>							<span class="pln">minute</span> <span class="pun">=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">dt</span><span class="pun">.</span><span class="typ">Minute</span><span class="pun">()</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">updateScore</span><span class="pun">(</span><span class="pln">uint8</span><span class="pun">(</span><span class="pln">hour</span><span class="pun">),</span> <span class="pln">uint8</span><span class="pun">(</span><span class="pln">minute</span><span class="pun">),</span> <span class="kwd">true</span><span class="pun">)</span></li>
    <li>							<span class="pln">playerLoss</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>							<span class="pln">gameStopped</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>						<span class="pun">}</span></li>
    <li>						<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">&gt;=</span> <span class="dec">30</span> <span class="pun">||</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">&lt;=</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">=</span> <span class="pun">-</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span></li>
    <li>						<span class="pun">}</span></li>
    <li></li>
    <li>						<span class="com">// when the ball is on the other side of the court, move the player "randomly" to simulate an AI</span></li>
    <li>						<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">==</span> <span class="kwd">float32</span><span class="pun">(</span><span class="dec">40</span><span class="pun">+</span><span class="pln">rand</span><span class="pun">.</span><span class="typ">Int31n</span><span class="pun">(</span><span class="dec">13</span><span class="pun">))</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">-</span> <span class="dec">3</span></li>
    <li>							<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&lt;</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>								<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>							<span class="pun">}</span></li>
    <li>							<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&gt;</span> <span class="dec">24</span> <span class="pun">{</span></li>
    <li>								<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">24</span></li>
    <li>							<span class="pun">}</span></li>
    <li>						<span class="pun">}</span></li>
    <li>						<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">==</span> <span class="kwd">float32</span><span class="pun">(</span><span class="dec">8</span><span class="pun">+</span><span class="pln">rand</span><span class="pun">.</span><span class="typ">Int31n</span><span class="pun">(</span><span class="dec">13</span><span class="pun">))</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">-</span> <span class="dec">3</span></li>
    <li>							<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&lt;</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>								<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>							<span class="pun">}</span></li>
    <li>							<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&gt;</span> <span class="dec">24</span> <span class="pun">{</span></li>
    <li>								<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">24</span></li>
    <li>							<span class="pun">}</span></li>
    <li>						<span class="pun">}</span></li>
    <li></li>
    <li>						<span class="kwd">if</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span><span class="pun">)</span> <span class="pun">&gt;</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">y</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">y</span><span class="pun">++</span></li>
    <li>						<span class="pun">}</span> <span class="kwd">else</span> <span class="kwd">if</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span><span class="pun">)</span> <span class="pun">&lt;</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">y</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">y</span><span class="pun">--</span></li>
    <li>						<span class="pun">}</span></li>
    <li></li>
    <li>						<span class="kwd">if</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span><span class="pun">)</span> <span class="pun">&gt;</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">y</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">y</span><span class="pun">++</span></li>
    <li>						<span class="pun">}</span> <span class="kwd">else</span> <span class="kwd">if</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span><span class="pun">)</span> <span class="pun">&lt;</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">y</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">y</span><span class="pun">--</span></li>
    <li>						<span class="pun">}</span></li>
    <li></li>
    <li>						<span class="com">// If the ball is in the middle, check if we need to lose and calculate the endpoint to avoid/hit the ball</span></li>
    <li>						<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">==</span> <span class="dec">32</span> <span class="pun">{</span></li>
    <li></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">dt</span><span class="pun">,</span> <span class="pln">err</span> <span class="pun">=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">rtc</span><span class="pun">.</span><span class="typ">ReadTime</span><span class="pun">()</span></li>
    <li>							<span class="kwd">if</span> <span class="pln">err</span> <span class="pun">!=</span> <span class="kwd">nil</span> <span class="pun">{</span></li>
    <li>								<span class="pln">println</span><span class="pun">(</span><span class="str">"Error reading date:"</span><span class="pun">,</span> <span class="pln">err</span><span class="pun">)</span></li>
    <li>								<span class="kwd">return</span></li>
    <li>							<span class="pun">}</span></li>
    <li>							<span class="kwd">if</span> <span class="pln">minute</span> <span class="pun">!=</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">dt</span><span class="pun">.</span><span class="typ">Minute</span><span class="pun">()</span> <span class="pun">&amp;&amp;</span> <span class="pln">playerLoss</span> <span class="pun">==</span> <span class="dec">0</span> <span class="pun">{</span> <span class="com">// needs to change one or the other</span></li>
    <li>								<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">dt</span><span class="pun">.</span><span class="typ">Minute</span><span class="pun">()</span> <span class="pun">==</span> <span class="dec">0</span> <span class="pun">{</span> <span class="com">// need to change hour</span></li>
    <li>									<span class="pln">playerLoss</span> <span class="pun">=</span> <span class="dec">1</span></li>
    <li>								<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span> <span class="com">// need to change the minute</span></li>
    <li>									<span class="pln">playerLoss</span> <span class="pun">=</span> <span class="pun">-</span><span class="dec">1</span></li>
    <li>								<span class="pun">}</span></li>
    <li>							<span class="pun">}</span></li>
    <li></li>
    <li>							<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span> <span class="pun">&lt;</span> <span class="dec">0</span> <span class="pun">{</span> <span class="com">// moving to the left</span></li>
    <li>								<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="pln">calculateEndPoint</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span><span class="pun">,</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span><span class="pun">,</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span><span class="pun">,</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span><span class="pun">,</span> <span class="pln">playerLoss</span> <span class="pun">!=</span> <span class="pun">-</span><span class="dec">1</span><span class="pun">)</span> <span class="pun">-</span> <span class="dec">3</span></li>
    <li>								<span class="kwd">if</span> <span class="pln">playerLoss</span> <span class="pun">==</span> <span class="pun">-</span><span class="dec">1</span> <span class="pun">{</span> <span class="com">// we need to lose</span></li>
    <li>									<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&lt;</span> <span class="dec">16</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">19</span> <span class="pun">+</span> <span class="dec">5</span><span class="pun">*</span><span class="pln">rand</span><span class="pun">.</span><span class="typ">Float32</span><span class="pun">()</span></li>
    <li>									<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">5</span> <span class="pun">*</span> <span class="pln">rand</span><span class="pun">.</span><span class="typ">Float32</span><span class="pun">()</span></li>
    <li>									<span class="pun">}</span></li>
    <li>								<span class="pun">}</span></li>
    <li>								<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&lt;</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>									<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>								<span class="pun">}</span></li>
    <li>								<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&gt;</span> <span class="dec">24</span> <span class="pun">{</span></li>
    <li>									<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">24</span></li>
    <li>								<span class="pun">}</span></li>
    <li>							<span class="pun">}</span></li>
    <li>							<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span> <span class="pun">&gt;</span> <span class="dec">0</span> <span class="pun">{</span> <span class="com">// moving to the right</span></li>
    <li>								<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="pln">calculateEndPoint</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span><span class="pun">,</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span><span class="pun">,</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span><span class="pun">,</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span><span class="pun">,</span> <span class="pln">playerLoss</span> <span class="pun">!=</span> <span class="dec">1</span><span class="pun">)</span> <span class="pun">-</span> <span class="dec">3</span></li>
    <li>								<span class="kwd">if</span> <span class="pln">playerLoss</span> <span class="pun">==</span> <span class="dec">1</span> <span class="pun">{</span> <span class="com">// we need to lose</span></li>
    <li>									<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&lt;</span> <span class="dec">16</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">19</span> <span class="pun">+</span> <span class="dec">5</span><span class="pun">*</span><span class="pln">rand</span><span class="pun">.</span><span class="typ">Float32</span><span class="pun">()</span></li>
    <li>									<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>										<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">5</span> <span class="pun">*</span> <span class="pln">rand</span><span class="pun">.</span><span class="typ">Float32</span><span class="pun">()</span></li>
    <li>									<span class="pun">}</span></li>
    <li>								<span class="pun">}</span></li>
    <li>								<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&lt;</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>									<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>								<span class="pun">}</span></li>
    <li>								<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">&gt;</span> <span class="dec">24</span> <span class="pun">{</span></li>
    <li>									<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">targetY</span> <span class="pun">=</span> <span class="dec">24</span></li>
    <li>								<span class="pun">}</span></li>
    <li>							<span class="pun">}</span></li>
    <li>						<span class="pun">}</span></li>
    <li></li>
    <li>						<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">&lt;</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">=</span> <span class="dec">0</span></li>
    <li>						<span class="pun">}</span></li>
    <li>						<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">&gt;</span> <span class="dec">30</span> <span class="pun">{</span></li>
    <li>							<span class="pln">game</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">=</span> <span class="dec">30</span></li>
    <li>						<span class="pun">}</span></li>
    <li>					<span class="pun">}</span></li>
    <li></li>
    <li>					<span class="kwd">if</span> <span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">lastY</span> <span class="pun">!=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">pin</span><span class="pun">.</span><span class="typ">Get</span><span class="pun">()/</span><span class="dec">16384</span><span class="pun">)</span> <span class="pun">||</span></li>
    <li>						<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">lastY</span> <span class="pun">!=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">pin</span><span class="pun">.</span><span class="typ">Get</span><span class="pun">()/</span><span class="dec">16384</span><span class="pun">)</span> <span class="pun">{</span></li>
    <li>						<span class="pln">game</span><span class="pun">.</span><span class="pln">status</span> <span class="pun">=</span> <span class="typ">PLAY</span></li>
    <li>					<span class="pun">}</span></li>
    <li>					<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">lastY</span> <span class="pun">=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">0</span><span class="pun">].</span><span class="pln">pin</span><span class="pun">.</span><span class="typ">Get</span><span class="pun">()</span> <span class="pun">/</span> <span class="dec">16384</span><span class="pun">)</span></li>
    <li>					<span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">lastY</span> <span class="pun">=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">game</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="dec">1</span><span class="pun">].</span><span class="pln">pin</span><span class="pun">.</span><span class="typ">Get</span><span class="pun">()</span> <span class="pun">/</span> <span class="dec">16384</span><span class="pun">)</span></li>
    <li></li>
    <li>					<span class="com">// show stuff on the display</span></li>
    <li>					<span class="pln">game</span><span class="pun">.</span><span class="pln">drawNet</span><span class="pun">()</span></li>
    <li>					<span class="pln">game</span><span class="pun">.</span><span class="pln">drawPlayers</span><span class="pun">()</span></li>
    <li>					<span class="pln">game</span><span class="pun">.</span><span class="pln">drawBall</span><span class="pun">()</span></li>
    <li>					<span class="pln">game</span><span class="pun">.</span><span class="pln">updateScore</span><span class="pun">(</span><span class="pln">uint8</span><span class="pun">(</span><span class="pln">hour</span><span class="pun">),</span> <span class="pln">uint8</span><span class="pun">(</span><span class="pln">minute</span><span class="pun">),</span> <span class="kwd">true</span><span class="pun">)</span></li>
    <li>				<span class="pun">}</span></li>
    <li>				<span class="pln">game</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">Display</span><span class="pun">()</span></li>
    <li>			<span class="pun">}</span></li>
    <li>			<span class="kwd">break</span></li>
    <li>		<span class="pun">}</span></li>
    <li>	<span class="pun">}</span></li>
    <li><span class="pun">}</span></li>
    <li></li>
    <li><span class="kwd">func</span> <span class="pun">(</span><span class="pln">g</span> <span class="pun">*</span><span class="typ">Game</span><span class="pun">)</span> <span class="pln">newRound</span><span class="pun">(</span><span class="pln">winner</span> <span class="pln">uint8</span><span class="pun">)</span> <span class="pun">{</span></li>
    <li>	<span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span> <span class="pun">=</span> <span class="kwd">float32</span><span class="pun">(</span><span class="dec">31</span><span class="pun">)</span></li>
    <li>	<span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span> <span class="pun">=</span> <span class="pln">rand</span><span class="pun">.</span><span class="typ">Float32</span><span class="pun">()*</span><span class="dec">16</span> <span class="pun">+</span> <span class="dec">8</span></li>
    <li>	<span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vx</span> <span class="pun">=</span> <span class="kwd">float32</span><span class="pun">(</span><span class="dec">1</span><span class="pun">)</span></li>
    <li>	<span class="kwd">if</span> <span class="pln">winner</span> <span class="pun">==</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>		<span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">=</span> <span class="dec">0.5</span></li>
    <li>	<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>		<span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">vy</span> <span class="pun">=</span> <span class="pun">-</span><span class="dec">0.5</span></li>
    <li>	<span class="pun">}</span></li>
    <li>	<span class="pln">g</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="pln">winner</span><span class="pun">].</span><span class="pln">score</span><span class="pun">++</span></li>
    <li>	<span class="kwd">if</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="pln">winner</span><span class="pun">].</span><span class="pln">score</span> <span class="pun">&gt;</span> <span class="dec">50</span> <span class="pun">{</span></li>
    <li>		<span class="pln">g</span><span class="pun">.</span><span class="pln">status</span> <span class="pun">=</span> <span class="typ">WINNER</span></li>
    <li>	<span class="pun">}</span></li>
    <li><span class="pun">}</span></li>
    <li></li>
    <li><span class="kwd">func</span> <span class="pun">(</span><span class="pln">g</span> <span class="pun">*</span><span class="typ">Game</span><span class="pun">)</span> <span class="pln">drawNet</span><span class="pun">()</span> <span class="pun">{</span></li>
    <li>	<span class="kwd">for</span> <span class="pln">i</span> <span class="pun">:=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="dec">1</span><span class="pun">);</span> <span class="pln">i</span> <span class="pun">&lt;</span> <span class="dec">32</span><span class="pun">;</span> <span class="pln">i</span> <span class="pun">+=</span> <span class="dec">2</span> <span class="pun">{</span></li>
    <li>		<span class="pln">g</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">SetPixel</span><span class="pun">(</span><span class="dec">31</span><span class="pun">,</span> <span class="pln">i</span><span class="pun">,</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">colors</span><span class="pun">[</span><span class="dec">6</span><span class="pun">])</span></li>
    <li>	<span class="pun">}</span></li>
    <li><span class="pun">}</span></li>
    <li></li>
    <li><span class="kwd">func</span> <span class="pun">(</span><span class="pln">g</span> <span class="pun">*</span><span class="typ">Game</span><span class="pun">)</span> <span class="pln">drawPlayers</span><span class="pun">()</span> <span class="pun">{</span></li>
    <li>	<span class="kwd">for</span> <span class="pln">k</span> <span class="pun">:=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="dec">0</span><span class="pun">);</span> <span class="pln">k</span> <span class="pun">&lt;</span> <span class="dec">2</span><span class="pun">;</span> <span class="pln">k</span><span class="pun">++</span> <span class="pun">{</span></li>
    <li>		<span class="kwd">for</span> <span class="pln">i</span> <span class="pun">:=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="dec">0</span><span class="pun">);</span> <span class="pln">i</span> <span class="pun">&lt;</span> <span class="dec">2</span><span class="pun">;</span> <span class="pln">i</span><span class="pun">++</span> <span class="pun">{</span></li>
    <li>			<span class="kwd">for</span> <span class="pln">j</span> <span class="pun">:=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="dec">0</span><span class="pun">);</span> <span class="pln">j</span> <span class="pun">&lt;</span> <span class="dec">8</span><span class="pun">;</span> <span class="pln">j</span><span class="pun">++</span> <span class="pun">{</span></li>
    <li>				<span class="pln">g</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">SetPixel</span><span class="pun">((</span><span class="pln">k</span><span class="pun">*</span><span class="dec">62</span><span class="pun">)+</span><span class="pln">i</span><span class="pun">,</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">players</span><span class="pun">[</span><span class="pln">k</span><span class="pun">].</span><span class="pln">y</span><span class="pun">+</span><span class="pln">j</span><span class="pun">,</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">colors</span><span class="pun">[</span><span class="dec">3</span><span class="pun">])</span></li>
    <li>			<span class="pun">}</span></li>
    <li>		<span class="pun">}</span></li>
    <li>	<span class="pun">}</span></li>
    <li><span class="pun">}</span></li>
    <li></li>
    <li><span class="kwd">func</span> <span class="pun">(</span><span class="pln">g</span> <span class="pun">*</span><span class="typ">Game</span><span class="pun">)</span> <span class="pln">drawPlayer</span><span class="pun">(</span><span class="pln">x</span> <span class="kwd">int16</span><span class="pun">,</span> <span class="pln">y</span> <span class="kwd">int16</span><span class="pun">)</span> <span class="pun">{</span></li>
    <li>	<span class="kwd">for</span> <span class="pln">i</span> <span class="pun">:=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="dec">0</span><span class="pun">);</span> <span class="pln">i</span> <span class="pun">&lt;</span> <span class="dec">2</span><span class="pun">;</span> <span class="pln">i</span><span class="pun">++</span> <span class="pun">{</span></li>
    <li>		<span class="kwd">for</span> <span class="pln">j</span> <span class="pun">:=</span> <span class="kwd">int16</span><span class="pun">(</span><span class="dec">0</span><span class="pun">);</span> <span class="pln">j</span> <span class="pun">&lt;</span> <span class="dec">8</span><span class="pun">;</span> <span class="pln">j</span><span class="pun">++</span> <span class="pun">{</span></li>
    <li>			<span class="pln">g</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">SetPixel</span><span class="pun">(</span><span class="pln">x</span><span class="pun">+</span><span class="pln">i</span><span class="pun">,</span> <span class="pln">y</span><span class="pun">+</span><span class="pln">j</span><span class="pun">,</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">colors</span><span class="pun">[</span><span class="dec">3</span><span class="pun">])</span></li>
    <li>		<span class="pun">}</span></li>
    <li>	<span class="pun">}</span></li>
    <li><span class="pun">}</span></li>
    <li></li>
    <li><span class="kwd">func</span> <span class="pun">(</span><span class="pln">g</span> <span class="pun">*</span><span class="typ">Game</span><span class="pun">)</span> <span class="pln">drawBall</span><span class="pun">()</span> <span class="pun">{</span></li>
    <li>	<span class="pln">g</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">SetPixel</span><span class="pun">(</span><span class="kwd">int16</span><span class="pun">(</span><span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span><span class="pun">),</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span><span class="pun">),</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">colors</span><span class="pun">[</span><span class="dec">1</span><span class="pun">])</span></li>
    <li>	<span class="pln">g</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">SetPixel</span><span class="pun">(</span><span class="kwd">int16</span><span class="pun">(</span><span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span><span class="pun">)+</span><span class="dec">1</span><span class="pun">,</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span><span class="pun">),</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">colors</span><span class="pun">[</span><span class="dec">1</span><span class="pun">])</span></li>
    <li>	<span class="pln">g</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">SetPixel</span><span class="pun">(</span><span class="kwd">int16</span><span class="pun">(</span><span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span><span class="pun">),</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span><span class="pun">)+</span><span class="dec">1</span><span class="pun">,</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">colors</span><span class="pun">[</span><span class="dec">1</span><span class="pun">])</span></li>
    <li>	<span class="pln">g</span><span class="pun">.</span><span class="pln">display</span><span class="pun">.</span><span class="typ">SetPixel</span><span class="pun">(</span><span class="kwd">int16</span><span class="pun">(</span><span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">x</span><span class="pun">)+</span><span class="dec">1</span><span class="pun">,</span> <span class="kwd">int16</span><span class="pun">(</span><span class="pln">g</span><span class="pun">.</span><span class="pln">ball</span><span class="pun">.</span><span class="pln">y</span><span class="pun">)+</span><span class="dec">1</span><span class="pun">,</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">colors</span><span class="pun">[</span><span class="dec">1</span><span class="pun">])</span></li>
    <li><span class="pun">}</span></li>
    <li></li>
    <li><span class="kwd">func</span> <span class="pln">calculateEndPoint</span><span class="pun">(</span><span class="pln">x</span> <span class="kwd">float32</span><span class="pun">,</span> <span class="pln">y</span> <span class="kwd">float32</span><span class="pun">,</span> <span class="pln">vx</span> <span class="kwd">float32</span><span class="pun">,</span> <span class="pln">vy</span> <span class="kwd">float32</span><span class="pun">,</span> <span class="pln">hit</span> <span class="kwd">bool</span><span class="pun">)</span> <span class="pun">(</span><span class="pln">ty</span> <span class="kwd">float32</span><span class="pun">)</span> <span class="pun">{</span></li>
    <li>	<span class="kwd">for</span> <span class="pun">{</span></li>
    <li>		<span class="pln">x</span> <span class="pun">+=</span> <span class="pln">vx</span></li>
    <li>		<span class="pln">y</span> <span class="pun">+=</span> <span class="pln">vy</span></li>
    <li>		<span class="kwd">if</span> <span class="pln">hit</span> <span class="pun">{</span></li>
    <li>			<span class="kwd">if</span> <span class="pln">x</span> <span class="pun">&gt;=</span> <span class="dec">60</span> <span class="pun">||</span> <span class="pln">x</span> <span class="pun">&lt;=</span> <span class="dec">2</span> <span class="pun">{</span></li>
    <li>				<span class="kwd">return</span> <span class="pln">y</span></li>
    <li>			<span class="pun">}</span></li>
    <li>		<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>			<span class="kwd">if</span> <span class="pln">x</span> <span class="pun">&gt;=</span> <span class="dec">62</span> <span class="pun">||</span> <span class="pln">x</span> <span class="pun">&lt;=</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>				<span class="kwd">return</span> <span class="pln">y</span></li>
    <li>			<span class="pun">}</span></li>
    <li>		<span class="pun">}</span></li>
    <li>		<span class="kwd">if</span> <span class="pln">y</span> <span class="pun">&gt;=</span> <span class="dec">30</span> <span class="pun">||</span> <span class="pln">y</span> <span class="pun">&lt;=</span> <span class="dec">0</span> <span class="pun">{</span></li>
    <li>			<span class="pln">vy</span> <span class="pun">=</span> <span class="pun">-</span><span class="pln">vy</span></li>
    <li>		<span class="pun">}</span></li>
    <li>	<span class="pun">}</span></li>
    <li><span class="pun">}</span></li>
    <li></li>
    <li><span class="kwd">func</span> <span class="pun">(</span><span class="pln">g</span> <span class="pun">*</span><span class="typ">Game</span><span class="pun">)</span> <span class="pln">updateScore</span><span class="pun">(</span><span class="pln">scoreLeft</span> <span class="pln">uint8</span><span class="pun">,</span> <span class="pln">scoreRight</span> <span class="pln">uint8</span><span class="pun">,</span> <span class="pln">showTime</span> <span class="kwd">bool</span><span class="pun">)</span> <span class="pun">{</span></li>
    <li>	<span class="pln">g</span><span class="pun">.</span><span class="pln">timeStr</span><span class="pun">[</span><span class="dec">1</span><span class="pun">]</span> <span class="pun">=</span> <span class="dec">48</span> <span class="pun">+</span> <span class="pun">(</span><span class="pln">scoreLeft</span> <span class="pun">%</span> <span class="dec">10</span><span class="pun">)</span></li>
    <li>	<span class="kwd">if</span> <span class="pln">scoreLeft</span> <span class="pun">&gt;</span> <span class="dec">9</span> <span class="pun">{</span></li>
    <li>		<span class="pln">g</span><span class="pun">.</span><span class="pln">timeStr</span><span class="pun">[</span><span class="dec">0</span><span class="pun">]</span> <span class="pun">=</span> <span class="dec">48</span> <span class="pun">+</span> <span class="pun">(</span><span class="pln">scoreLeft</span> <span class="pun">/</span> <span class="dec">10</span><span class="pun">)</span></li>
    <li>	<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>		<span class="pln">g</span><span class="pun">.</span><span class="pln">timeStr</span><span class="pun">[</span><span class="dec">0</span><span class="pun">]</span> <span class="pun">=</span> <span class="dec">32</span></li>
    <li>	<span class="pun">}</span></li>
    <li>	<span class="pln">tinyfont</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(&amp;</span><span class="pln">g</span><span class="pun">.</span><span class="pln">display</span><span class="pun">,</span> <span class="pun">&amp;</span><span class="pln">tinyfont</span><span class="pun">.</span><span class="typ">TomThumb</span><span class="pun">,</span> <span class="dec">23</span><span class="pun">,</span> <span class="dec">5</span><span class="pun">,</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">timeStr</span><span class="pun">,</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">colors</span><span class="pun">[</span><span class="dec">6</span><span class="pun">])</span></li>
    <li></li>
    <li>	<span class="pln">g</span><span class="pun">.</span><span class="pln">timeStr</span><span class="pun">[</span><span class="dec">1</span><span class="pun">]</span> <span class="pun">=</span> <span class="dec">48</span> <span class="pun">+</span> <span class="pun">(</span><span class="pln">scoreRight</span> <span class="pun">%</span> <span class="dec">10</span><span class="pun">)</span></li>
    <li>	<span class="kwd">if</span> <span class="pln">scoreRight</span> <span class="pun">&gt;</span> <span class="dec">9</span> <span class="pun">{</span></li>
    <li>		<span class="pln">g</span><span class="pun">.</span><span class="pln">timeStr</span><span class="pun">[</span><span class="dec">0</span><span class="pun">]</span> <span class="pun">=</span> <span class="dec">48</span> <span class="pun">+</span> <span class="pun">(</span><span class="pln">scoreRight</span> <span class="pun">/</span> <span class="dec">10</span><span class="pun">)</span></li>
    <li>	<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>		<span class="kwd">if</span> <span class="pln">showTime</span> <span class="pun">{</span></li>
    <li>			<span class="pln">g</span><span class="pun">.</span><span class="pln">timeStr</span><span class="pun">[</span><span class="dec">0</span><span class="pun">]</span> <span class="pun">=</span> <span class="dec">48</span></li>
    <li>		<span class="pun">}</span> <span class="kwd">else</span> <span class="pun">{</span></li>
    <li>			<span class="pln">g</span><span class="pun">.</span><span class="pln">timeStr</span><span class="pun">[</span><span class="dec">0</span><span class="pun">]</span> <span class="pun">=</span> <span class="dec">32</span></li>
    <li>		<span class="pun">}</span></li>
    <li>	<span class="pun">}</span></li>
    <li>	<span class="pln">tinyfont</span><span class="pun">.</span><span class="typ">WriteLine</span><span class="pun">(&amp;</span><span class="pln">g</span><span class="pun">.</span><span class="pln">display</span><span class="pun">,</span> <span class="pun">&amp;</span><span class="pln">tinyfont</span><span class="pun">.</span><span class="typ">TomThumb</span><span class="pun">,</span> <span class="dec">33</span><span class="pun">,</span> <span class="dec">5</span><span class="pun">,</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">timeStr</span><span class="pun">,</span> <span class="pln">g</span><span class="pun">.</span><span class="pln">colors</span><span class="pun">[</span><span class="dec">6</span><span class="pun">])</span></li>
    <li><span class="pun">}</span></li>
    <li></li>
    </ol>
</div>